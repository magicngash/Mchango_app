<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Real Pedometer App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .phone-container {
            max-width: 375px;
            width: 100%;
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            height: 812px;
            display: flex;
            flex-direction: column;
        }
        .status-bar {
            background: #4A90E2;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }
        .app-content {
            flex: 1;
            overflow-y: auto;
        }
        .screen {
            display: none;
            padding: 20px;
            height: 100%;
        }
        .screen.active {
            display: block;
        }
        /* Home Screen Styles */
        .step-counter {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step-count-label {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        .step-count {
            font-size: 48px;
            font-weight: bold;
            color: #4A90E2;
            margin-bottom: 5px;
        }
        .goal-text {
            font-size: 16px;
            color: #888;
        }
        .progress-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4A90E2, #5BA0F2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 16px;
            color: #666;
        }
        .stats-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4A90E2;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        .control-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .control-button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .start-button {
            background: #4CAF50;
            color: white;
        }
        .start-button:hover {
            background: #3D8B40;
        }
        .stop-button {
            background: #F44336;
            color: white;
        }
        .stop-button:hover {
            background: #D32F2F;
        }
        .reset-button {
            background: #FFC107;
            color: #333;
        }
        .reset-button:hover {
            background: #FFA000;
        }
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
        }
        .status-active {
            background: #E8F5E9;
            color: #2E7D32;
        }
        .status-inactive {
            background: #FFEBEE;
            color: #C62828;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .dot-active {
            background: #4CAF50;
        }
        .dot-inactive {
            background: #F44336;
        }
        /* History Screen Styles */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 120px;
            margin: 20px 0;
        }
        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 2px;
        }
        .bar-value {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
            height: 15px;
        }
        .bar {
            width: 80%;
            background: linear-gradient(to top, #4A90E2, #5BA0F2);
            border-radius: 2px;
            min-height: 2px;
            transition: height 0.5s ease;
        }
        .bar-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .history-table {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .table-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .table-row:last-child {
            border-bottom: none;
        }
        .date-col {
            flex: 1;
            text-align: center;
        }
        .steps-col {
            flex: 2;
            text-align: center;
        }
        .distance-col {
            flex: 1;
            text-align: center;
        }
        .day-name {
            font-size: 14px;
            color: #666;
        }
        .date-number {
            font-size: 16px;
            font-weight: bold;
        }
        .steps-value {
            font-size: 16px;
            font-weight: bold;
            color: #4A90E2;
        }
        .distance-value {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
        }
        /* Settings Screen Styles */
        .setting-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .setting-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .setting-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
        .input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            background: #f9f9f9;
        }
        .save-button {
            width: 100%;
            padding: 15px;
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        .save-button:hover {
            background: #3A80D2;
        }
        .info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        /* Tab Navigation */
        .tab-bar {
            height: 70px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: color 0.2s;
            color: #999;
        }
        .tab-item.active {
            color: #4A90E2;
        }
        .tab-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }
        .tab-label {
            font-size: 12px;
        }
        /* Permission Notice */
        .permission-notice {
            background: #E3F2FD;
            color: #1565C0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        .permission-button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .permission-button:hover {
            background: #3A80D2;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <span id="currentTime">9:41</span>
            <span>Real Pedometer</span>
            <span id="batteryLevel">100%</span>
        </div>
        <!-- App Content -->
        <div class="app-content">
            <!-- Home Screen -->
            <div id="home" class="screen active">
                <div class="step-counter">
                    <div class="step-count-label">Steps Today</div>
                    <div class="step-count" id="stepCount">0</div>
                    <div class="goal-text">Goal: <span id="goalText">10,000</span></div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progressText">0% of daily goal</div>
                </div>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="distanceValue">0.00</div>
                        <div class="stat-label">km walked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="caloriesValue">0</div>
                        <div class="stat-label">calories burned</div>
                    </div>
                </div>
                <div class="control-container">
                    <button class="control-button start-button" id="startButton" onclick="startPedometer()">Start</button>
                    <button class="control-button stop-button" id="stopButton" onclick="stopPedometer()" style="display: none;">Stop</button>
                    <button class="control-button reset-button" onclick="resetSteps()">Reset</button>
                </div>
                <div class="status-indicator status-inactive" id="statusIndicator">
                    <div class="status-dot dot-inactive" id="statusDot"></div>
                    <span id="statusText">Pedometer is inactive</span>
                </div>
                <div class="permission-notice" id="permissionNotice" style="display: none;">
                    <p>This app needs permission to access your device's motion sensors to count steps.</p>
                    <button class="permission-button" onclick="requestPermission()">Grant Permission</button>
                </div>
            </div>
            <!-- History Screen -->
            <div id="history" class="screen">
                <div class="chart-container">
                    <div class="chart-title">7-Day Step History</div>
                    <div class="bar-chart" id="barChart">
                        <!-- Chart bars will be generated by JavaScript -->
                    </div>
                </div>
                <div class="history-table">
                    <div class="chart-title">Daily Summary</div>
                    <div id="historyTable">
                        <!-- History rows will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            <!-- Settings Screen -->
            <div id="settings" class="screen">
                <div class="setting-card">
                    <div class="setting-title">Daily Step Goal</div>
                    <input type="number" class="input" id="goalInput" placeholder="Enter daily step goal" value="10000">
                    <button class="save-button" onclick="saveGoal()">Save Goal</button>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Weight (kg)</div>
                    <div class="setting-description">Used for more accurate calorie calculations</div>
                    <input type="number" class="input" id="weightInput" placeholder="Enter weight in kg" value="70">
                    <button class="save-button" onclick="saveWeight()">Save Weight</button>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Step Sensitivity</div>
                    <div class="setting-description">Adjust based on your walking style</div>
                    <input type="range" class="input" id="sensitivityInput" min="1" max="10" value="5">
                    <button class="save-button" onclick="saveSensitivity()">Save Sensitivity</button>
                </div>
                <div class="setting-card">
                    <div class="setting-title">About Step Counting</div>
                    <div class="info-text">
                        • Average step length: 0.75 meters<br>
                        • Calorie calculation: steps × 0.04 × weight factor<br>
                        • Data resets daily at midnight<br>
                        • History shows last 7 days<br><br>
                        <strong>Note:</strong> This app uses your device's motion sensors to detect steps. For best results, keep your phone in your pocket while walking.
                    </div>
                </div>
            </div>
        </div>
        <!-- Tab Bar -->
        <div class="tab-bar">
            <div class="tab-item active" onclick="showScreen('home', this)">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 12L8 10l2-2 2 2-2 2zM10 2L3 9h2v8h10V9h2L10 2z"/>
                </svg>
                <div class="tab-label">Home</div>
            </div>
            <div class="tab-item" onclick="showScreen('history', this)">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v10H5V5z"/>
                    <path d="M7 7h2v6H7V7zm4 0h2v6h-2V7z"/>
                </svg>
                <div class="tab-label">History</div>
            </div>
            <div class="tab-item" onclick="showScreen('settings', this)">
                <svg class="tab-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
                <div class="tab-label">Settings</div>
            </div>
        </div>
    </div>
    <script>
        // App state
        let stepCount = parseInt(localStorage.getItem('stepCount')) || 0;
        let dailyGoal = parseInt(localStorage.getItem('dailyGoal')) || 10000;
        let userWeight = parseInt(localStorage.getItem('userWeight')) || 70;
        let sensitivity = parseInt(localStorage.getItem('sensitivity')) || 5;
        let history = JSON.parse(localStorage.getItem('history')) || [];
        let isActive = false;
        let lastStepTime = 0;
        let stepThreshold = 11 - sensitivity; // Higher sensitivity = lower threshold
        
        // Initialize the app
        function initApp() {
            try {
                updateDisplay();
                generateHistory();
                updateHistoryDisplay();
                updateTime();
                setInterval(updateTime, 1000);
                
                // Load settings with error checking
                const goalInput = document.getElementById('goalInput');
                const weightInput = document.getElementById('weightInput');
                const sensitivityInput = document.getElementById('sensitivityInput');
                
                if (goalInput) goalInput.value = dailyGoal;
                if (weightInput) weightInput.value = userWeight;
                if (sensitivityInput) sensitivityInput.value = sensitivity;
                
                // Check for motion sensor support
                if (!window.DeviceMotionEvent) {
                    document.getElementById('permissionNotice').style.display = 'block';
                    document.getElementById('permissionNotice').innerHTML = 
                        '<p>Your device does not support motion sensors. This app requires a device with an accelerometer.</p>';
                }
            } catch (error) {
                console.error('Error initializing app:', error);
            }
        }
        
        // Update current time
        function updateTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            document.getElementById('currentTime').textContent = `${displayHours}:${minutes} ${ampm}`;
        }
        
        // Start pedometer
        function startPedometer() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                // iOS 13+ requires permission request
                DeviceMotionEvent.requestPermission()
                    .then(response => {
                        if (response === 'granted') {
                            initMotionSensors();
                        } else {
                            alert('Permission denied. Cannot count steps without motion sensor access.');
                        }
                    })
                    .catch(console.error);
            } else {
                // Non-iOS devices
                initMotionSensors();
            }
        }
        
        // Initialize motion sensors
        function initMotionSensors() {
            isActive = true;
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('stopButton').style.display = 'block';
            document.getElementById('statusIndicator').className = 'status-indicator status-active';
            document.getElementById('statusDot').className = 'status-dot dot-active';
            document.getElementById('statusText').textContent = 'Pedometer is active - Start walking!';
            
            window.addEventListener('devicemotion', handleMotion);
        }
        
        // Stop pedometer
        function stopPedometer() {
            isActive = false;
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('stopButton').style.display = 'none';
            document.getElementById('statusIndicator').className = 'status-indicator status-inactive';
            document.getElementById('statusDot').className = 'status-dot dot-inactive';
            document.getElementById('statusText').textContent = 'Pedometer is inactive';
            
            window.removeEventListener('devicemotion', handleMotion);
        }
        
        // Handle motion events
        function handleMotion(event) {
            if (!isActive) return;
            
            const acceleration = event.accelerationIncludingGravity;
            if (!acceleration) return;
            
            // Calculate magnitude of acceleration
            const magnitude = Math.sqrt(
                acceleration.x * acceleration.x + 
                acceleration.y * acceleration.y + 
                acceleration.z * acceleration.z
            );
            
            // Detect step pattern
            const now = Date.now();
            if (magnitude > stepThreshold && (now - lastStepTime) > 300) {
                stepCount++;
                lastStepTime = now;
                localStorage.setItem('stepCount', stepCount);
                updateDisplay();
                
                // Visual feedback
                const counter = document.getElementById('stepCount');
                counter.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    counter.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        // Reset steps
        function resetSteps() {
            if (confirm('Reset today\'s step count?')) {
                stepCount = 0;
                localStorage.setItem('stepCount', stepCount);
                updateDisplay();
                updateHistoryDisplay();
            }
        }
        
        // Request permission (for iOS)
        function requestPermission() {
            startPedometer();
        }
        
        // Update display values
        function updateDisplay() {
            const distance = (stepCount * 0.75 / 1000).toFixed(2);
            const calories = Math.round(stepCount * 0.04 * (userWeight / 70));
            const progress = Math.min((stepCount / dailyGoal) * 100, 100);
            
            document.getElementById('stepCount').textContent = stepCount.toLocaleString();
            document.getElementById('goalText').textContent = dailyGoal.toLocaleString();
            document.getElementById('distanceValue').textContent = distance;
            document.getElementById('caloriesValue').textContent = calories;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '% of daily goal';
        }
        
        // Generate sample history data
        function generateHistory() {
            if (history.length === 0) {
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    
                    const steps = i === 0 ? stepCount : Math.floor(Math.random() * 12000) + 3000;
                    const distance = (steps * 0.75 / 1000).toFixed(2);
                    
                    history.push({
                        date: date.toDateString(),
                        dayName: date.toLocaleDateString('en', { weekday: 'short' }),
                        dayNumber: date.getDate(),
                        steps: steps,
                        distance: distance
                    });
                }
                localStorage.setItem('history', JSON.stringify(history));
            }
        }
        
        // Update history display
        function updateHistoryDisplay() {
            // Update current day in history
            if (history.length > 0) {
                history[history.length - 1].steps = stepCount;
                history[history.length - 1].distance = (stepCount * 0.75 / 1000).toFixed(2);
            }
            
            // Generate bar chart
            const barChart = document.getElementById('barChart');
            const maxSteps = Math.max(...history.map(day => day.steps), 1);
            
            barChart.innerHTML = '';
            history.forEach(day => {
                const barHeight = Math.max((day.steps / maxSteps) * 100, 2);
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.innerHTML = `
                    <div class="bar-value">${day.steps > 999 ? Math.round(day.steps/1000) + 'k' : day.steps}</div>
                    <div class="bar" style="height: ${barHeight}px"></div>
                    <div class="bar-label">${day.dayName}</div>
                `;
                barChart.appendChild(barItem);
            });
            
            // Generate history table
            const historyTable = document.getElementById('historyTable');
            historyTable.innerHTML = '';
            history.forEach(day => {
                const row = document.createElement('div');
                row.className = 'table-row';
                row.innerHTML = `
                    <div class="date-col">
                        <div class="day-name">${day.dayName}</div>
                        <div class="date-number">${day.dayNumber}</div>
                    </div>
                    <div class="steps-col">
                        <div class="steps-value">${day.steps.toLocaleString()}</div>
                        <div class="stat-label">steps</div>
                    </div>
                    <div class="distance-col">
                        <div class="distance-value">${day.distance}</div>
                        <div class="stat-label">km</div>
                    </div>
                `;
                historyTable.appendChild(row);
            });
        }
        
        // Save goal setting
        function saveGoal() {
            const goalInput = document.getElementById('goalInput');
            if (!goalInput) return;
            
            const newGoal = parseInt(goalInput.value);
            if (newGoal >= 1000 && newGoal <= 50000) {
                dailyGoal = newGoal;
                localStorage.setItem('dailyGoal', dailyGoal);
                updateDisplay();
                alert('Daily goal updated!');
            } else {
                alert('Please enter a goal between 1,000 and 50,000 steps.');
            }
        }
        
        // Save weight setting
        function saveWeight() {
            const weightInput = document.getElementById('weightInput');
            if (!weightInput) return;
            
            const newWeight = parseInt(weightInput.value);
            if (newWeight >= 30 && newWeight <= 300) {
                userWeight = newWeight;
                localStorage.setItem('userWeight', userWeight);
                alert('Weight updated!');
            } else {
                alert('Please enter a weight between 30 and 300 kg.');
            }
        }
        
        // Save sensitivity setting
        function saveSensitivity() {
            const sensitivityInput = document.getElementById('sensitivityInput');
            if (!sensitivityInput) return;
            
            sensitivity = parseInt(sensitivityInput.value);
            stepThreshold = 11 - sensitivity; // Higher sensitivity = lower threshold
            localStorage.setItem('sensitivity', sensitivity);
            alert('Sensitivity updated!');
        }
        
        // Show screen
        function showScreen(screenName, element) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenName).classList.add('active');
            
            // Update tab bar
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            
            // Update history when switching to history tab
            if (screenName === 'history') {
                updateHistoryDisplay();
            }
        }
        
        // Check for daily reset at midnight
        function checkDailyReset() {
            const lastReset = localStorage.getItem('lastReset');
            const today = new Date().toDateString();
            
            if (lastReset !== today) {
                // Save today's steps to history
                if (history.length > 0) {
                    history[history.length - 1].steps = stepCount;
                    history[history.length - 1].distance = (stepCount * 0.75 / 1000).toFixed(2);
                }
                
                // Reset steps
                stepCount = 0;
                localStorage.setItem('stepCount', stepCount);
                localStorage.setItem('lastReset', today);
                
                // Add new day to history
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                history.push({
                    date: tomorrow.toDateString(),
                    dayName: tomorrow.toLocaleDateString('en', { weekday: 'short' }),
                    dayNumber: tomorrow.getDate(),
                    steps: 0,
                    distance: '0.00'
                });
                
                // Keep only last 7 days
                if (history.length > 7) {
                    history.shift();
                }
                
                localStorage.setItem('history', JSON.stringify(history));
                updateDisplay();
            }
        }
        
        // Initialize app when page loads
        window.addEventListener('load', () => {
            initApp();
            checkDailyReset();
            // Check for reset every minute
            setInterval(checkDailyReset, 60000);
        });
    </script>
</body>
</html>